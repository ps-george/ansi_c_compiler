gsp14 : Checking we're on branch cw1-hard
cd ${REPOS}/$U && git rev-parse --abbrev-ref HEAD

log_msg "########################################################"
gsp14 : ########################################################
log_msg "## Building"
gsp14 : ## Building

log_msg "Cleaning"
gsp14 : Cleaning
(cd $REPO && rm bin/c_lexer)
(cd $REPO && make clean)
rm -f bin/*
rm -f src/lexer/*.o
rm -f include/*.tab.*

log_msg "Building"
gsp14 : Building
(cd $REPO && make bin/c_lexer)
bison -d -o include/c_parser.tab.c -d src/parser/c_parser.y
mv include/c_parser.tab.c src/parser/
g++ -std=c++11 -W -Wall -g -MMD -Iinclude  -c -o src/lexer/lexer_main.o src/lexer/lexer_main.cpp
flex -o src/lexer/flexer.yy.cpp src/lexer/flexer.flex include/c_parser.tab.h 
g++ -std=c++11 -W -Wall -g -MMD -Iinclude  -c -o src/lexer/flexer.yy.o src/lexer/flexer.yy.cpp
src/lexer/flexer.yy.cpp: In function ‘int yy_get_next_buffer()’:
src/lexer/flexer.yy.cpp:1663:44: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
  if ((int) ((yy_n_chars) + number_to_move) > YY_CURRENT_BUFFER_LVALUE->yy_buf_size) {
                                            ^
src/lexer/flexer.flex: At global scope:
src/lexer/flexer.flex:163:27: warning: unused parameter ‘s’ [-Wunused-parameter]
src/lexer/flexer.yy.cpp:1740:17: warning: ‘void yyunput(int, char*)’ defined but not used [-Wunused-function]
     static void yyunput (int c, char * yy_bp )
                 ^
mkdir -p bin
g++ -MMD -Iinclude -std=c++11 -W -Wall -g -o bin/c_lexer src/lexer/lexer_main.o src/lexer/flexer.yy.o
rm src/lexer/flexer.yy.cpp

if [[ ! -f $REPO/bin/c_lexer ]]; then
    log_msg "No executable build"
    exit 0;
fi

log_msg "########################################################"
gsp14 : ########################################################
log_msg "## Executing lexer for inputs"
gsp14 : ## Executing lexer for inputs

log_msg "Cleaning + Copying inputs"
gsp14 : Cleaning + Copying inputs
(mkdir -p $LOGDIR/working)


log_msg "Running reference lexer"
gsp14 : Running reference lexer
for i in scripts/cw1/inputs/*.c ; do
    log_msg "####################"
    NAME=$(basename $i .c)
    log_msg "  Test ${i}"

    cp $i $LOGDIR/working/$NAME.c
    cat $LOGDIR/working/$NAME.c  |  scripts/cw1/ref_tokeniser/bin/c_lexer > $LOGDIR/working/$NAME.ref.json

    cat $LOGDIR/working/$NAME.c | (cd $REPO && bin/c_lexer ) >$LOGDIR/working/$NAME.got.json 2>$LOGDIR/working/$NAME.got.stderr

    python3 scripts/cw1/compare_json.py $U $NAME $LOGDIR/working/$NAME.ref.json $LOGDIR/working/$NAME.got.json >$LOGDIR/working/$NAME.compare.csv 2>$LOGDIR/working/$NAME.compare.stderr
done
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/char-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-7.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-8.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/expr-9.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-8.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/float-9.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/include-0.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/include-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/include-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/include-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/int-7.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/pointer-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/pointer-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/pointer-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/pointer-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/stat-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-5.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-6.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-7.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/string-8.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/struct-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/struct-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/struct-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/struct-4.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/var-decl-1.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/var-decl-2.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/var-decl-3.c
gsp14 : ####################
basename $i .c
gsp14 :   Test scripts/cw1/inputs/var-decl-4.c

cat $LOGDIR/working/*.compare.csv > $LOGDIR/working/all.compare.csv

python3 scripts/cw1/cw1-grade.py $U $LOGDIR/working/all.compare.csv $LOGDIR/$U-final.csv | tee $LOGDIR/summary.txt
    Token type | Percentage
          char |  91.67
          expr | 100.00
         float |  62.50
       include | 100.00
           int | 100.00
       pointer | 100.00
          stat | 100.00
        string |  87.50
        struct | 100.00
      var-decl | 100.00
                     |    Raw | Weight | Contrib
 Parts (token types) |  94.17 |  0.6 |  56.50
 StreamLine + Column |  88.33 |  0.2 |  17.67
 SourceFile+Line     |  88.33 |  0.2 |  17.67

Total :  91.83%

(cd $LOGDIR && tar -czf working.tar.gz working)

exit 0
gsp14 : Test Complete
